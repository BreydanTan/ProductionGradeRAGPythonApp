# 架构可视化 / Architecture Visuals

**用途**: 用简单的类比帮助理解系统架构

---

## 🍔 餐厅类比

想象这个RAG应用是一个智能餐厅：

```
┌─────────────────────────────────────────────┐
│  👤 顾客（用户）                             │
│  "我想了解机器学习"                          │
└───────────────┬─────────────────────────────┘
                │
                ↓
┌─────────────────────────────────────────────┐
│  📱 前台（Streamlit界面）                    │
│  "欢迎光临！您需要什么？"                    │
│  • 接收问题                                  │
│  • 显示结果                                  │
└───────────────┬─────────────────────────────┘
                │
                ↓
┌─────────────────────────────────────────────┐
│  🚦 传菜员（Inngest）                        │
│  "我来协调厨房的工作"                        │
│  • 管理工作流程                              │
│  • 确保不过载（限流）                        │
│  • 失败了重试                                │
└───────────────┬─────────────────────────────┘
                │
        ┌───────┴────────┐
        ↓                ↓
┌───────────────┐  ┌────────────────┐
│ 🔍 查找组     │  │ 👨‍🍳 厨师组      │
│ (向量搜索)    │  │ (OpenAI GPT)   │
│               │  │                │
│ • 在图书馆中  │  │ • 根据食材     │
│   找相关书籍  │  │   (上下文)     │
│               │  │ • 做出菜品     │
│               │  │   (答案)       │
└───────────────┘  └────────────────┘
        │
        ↓
┌─────────────────────────────────────────────┐
│  📚 图书馆（Qdrant向量数据库）               │
│  "存储所有文档的知识"                        │
│  • 每本书 = 一个PDF文档                      │
│  • 每一页 = 一个文本块                       │
│  • 索引卡 = 向量嵌入                         │
└─────────────────────────────────────────────┘
```

**关键理解**：
1. 📄 **PDF上传** = 把新书放进图书馆，并为每页做索引
2. ❓ **提问** = 顾客点单 → 查找食材 → 厨师做菜 → 上菜
3. 🔄 **向量搜索** = 用智能索引快速找到相关的书页
4. 🤖 **AI回答** = 厨师根据找到的食材（上下文）精心制作答案

---

## 🏗️ 技术层次图

```
┌─────────────────────────────────────────────┐
│  🎨 装饰层：Streamlit UI                     │
│  (用户看到的界面)                            │
└─────────────────────────────────────────────┘
                ↓
┌─────────────────────────────────────────────┐
│  🔄 编排层：Inngest工作流                    │
│  (协调所有工作)                              │
└─────────────────────────────────────────────┘
                ↓
┌─────────────────────────────────────────────┐
│  ⚙️ 逻辑层：FastAPI + Python业务逻辑         │
│  (处理请求的核心代码)                        │
└─────────────────────────────────────────────┘
                ↓
┌─────────────────────────────────────────────┐
│  🧠 AI层：OpenAI API                         │
│  (嵌入模型 + GPT模型)                        │
└─────────────────────────────────────────────┘
                ↓
┌─────────────────────────────────────────────┐
│  💾 数据层：Qdrant向量数据库                 │
│  (存储向量和文本)                            │
└─────────────────────────────────────────────┘
```

**每层的作用**：
- 🎨 **装饰层**: 让应用好看易用
- 🔄 **编排层**: 确保工作按正确顺序进行
- ⚙️ **逻辑层**: 执行具体的业务逻辑
- 🧠 **AI层**: 提供智能能力
- 💾 **数据层**: 持久化存储

---

## 📊 数据旅程

### 旅程1：PDF的一生

```
1. 诞生 📄
   用户上传PDF文件

2. 分解 ✂️
   PDF → 文本 → 小块（每块~1000字符）

3. 转化 🔮
   文本块 → OpenAI嵌入 → 3072维向量

4. 入库 📦
   向量 + 文本 → 存入Qdrant

5. 等待 ⏳
   在数据库中等待被查询
```

### 旅程2：问题的一生

```
1. 提问 ❓
   用户在界面输入问题

2. 转化 🔮
   问题 → OpenAI嵌入 → 3072维向量

3. 搜索 🔍
   在Qdrant中找最相似的5个文本块

4. 组装 🧩
   问题 + 5个文本块 → 完整提示词

5. 询问 🤖
   提示词 → GPT-4o-mini → 生成答案

6. 展示 ✨
   答案 + 来源 → 显示给用户
```

---

参考：project-mastery/analysis/00-project-overview.md
